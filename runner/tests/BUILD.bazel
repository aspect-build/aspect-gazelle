load("@aspect_gazelle//:gazelle.bzl", "gazelle_generation_test")
load("@rules_go//go:def.bzl", "go_binary", "go_library")

# Disable the gazelle extensions
# gazelle:exclude tests/**

[
    gazelle_generation_test(
        name = "%s_test" % t,
        dir = t,
        env = {
            "TEST_ORION_EXTENSIONS": "%s/%s" % (
                package_name(),
                t,
            ),
        },
        gazelle_binary = ":tests",
    )
    for t in [t.replace("/WORKSPACE", "") for t in glob(["*/WORKSPACE"])]
]

go_library(
    name = "tests_lib",
    srcs = ["test.go"],
    importpath = "github.com/aspect-build/aspect-gazelle/runner/tests",
    visibility = ["//visibility:private"],
    deps = ["//:runner"],
)

go_binary(
    name = "tests",
    embed = [":tests_lib"],
    visibility = ["//visibility:public"],
)
