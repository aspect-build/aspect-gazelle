diff --git a/walk/config.go b/walk/config.go
index 53dcabe..eb97da3 100644
--- a/walk/config.go
+++ b/walk/config.go
@@ -58,6 +58,12 @@ type walkConfig struct {
 	ignore              bool
 	follow              []string
 	validBuildFileNames []string // to be copied to config.Config
+
+	// PATCH(gitignore) ---
+	isGitIgnoreDisabled bool
+	gitIgnoreData       interface{}
+	isGitIgnoredExt     func([]string, bool) bool
+	// END PATCH(gitignore) ---
 }
 
 const (
@@ -139,7 +145,8 @@ func (cr *Configurer) CheckFlags(_ *flag.FlagSet, c *config.Config) error {
 }
 
 func (*Configurer) KnownDirectives() []string {
-	return []string{"build_file_name", "generation_mode", "exclude", "follow", "ignore"}
+	// PATCH(gitignore) ---
+	return []string{"build_file_name", "generation_mode", "exclude", "follow", "ignore", "gitignore"}
 }
 
 func (cr *Configurer) Configure(c *config.Config, rel string, f *rule.File) {
@@ -196,6 +203,9 @@ func configureForWalk(parent *walkConfig, rel string, f *rule.File) *walkConfig
 					log.Printf("the ignore directive does not take any arguments. Did you mean to use gazelle:exclude instead? in //%s '# gazelle:ignore %s'", f.Pkg, d.Value)
 				}
 				wc.ignore = true
+			case "gitignore":
+				// PATCH(gitignore) ---
+				wc.isGitIgnoreDisabled = d.Value != "enabled"
 			}
 		}
 	}
diff --git a/walk/dirinfo.go b/walk/dirinfo.go
index d2f989b..f884e11 100644
--- a/walk/dirinfo.go
+++ b/walk/dirinfo.go
@@ -5,6 +5,7 @@ import (
 	"os"
 	"path"
 	"path/filepath"
+	"strings"
 	"sync"
 
 	"github.com/bazelbuild/bazel-gazelle/rule"
@@ -69,14 +70,58 @@ func (w *walker) loadDirInfo(rel string) (DirInfo, error) {
 	}
 
 	info.config = configureForWalk(parentConfig, rel, info.File)
+
+	// PATCH(gitignore) ---
+	if w.gitignoreProcessor != nil {
+		// Process any new .gitignore files
+		for _, entry := range entries {
+			if entry.Name() == ".gitignore" {
+				gitignorePath := rel
+				if gitignorePath != "" {
+					gitignorePath += "/"
+				}
+				gitignorePath += entry.Name()
+				info.config.isGitIgnoredExt, info.config.gitIgnoreData = w.gitignoreProcessor(w.rootConfig.RepoRoot, gitignorePath, parentConfig.gitIgnoreData)
+				break
+			}
+		}
+	}
+	// END-PATCH(gitignore) ---
+
 	if info.config.isExcludedDir(rel) {
 		// Build file excludes the current directory. Ignore contents.
 		entries = nil
 	}
 
+	// PATCH(gitignore) ---
+	// Pre-compute gitignore path components once per directory to avoid
+	// a strings.Split allocation per entry.
+	var gitIgnoreParts []string
+	gitIgnoreActive := !info.config.isGitIgnoreDisabled && info.config.isGitIgnoredExt != nil
+	if gitIgnoreActive {
+		if rel != "" {
+			parentParts := strings.Split(rel, "/")
+			gitIgnoreParts = make([]string, len(parentParts)+1)
+			copy(gitIgnoreParts, parentParts)
+		} else {
+			gitIgnoreParts = make([]string, 1)
+		}
+	}
+	// END-PATCH(gitignore) ---
+
 	for _, e := range entries {
 		entryRel := path.Join(rel, e.Name())
 		e = maybeResolveSymlink(info.config, dir, entryRel, e)
+
+		// PATCH(gitignore) ---
+		if gitIgnoreActive {
+			gitIgnoreParts[len(gitIgnoreParts)-1] = e.Name()
+			if info.config.isGitIgnoredExt(gitIgnoreParts, e.IsDir()) {
+				continue
+			}
+		}
+		// END-PATCH(gitignore) ---
+
 		if e.IsDir() && !info.config.isExcludedDir(entryRel) {
 			info.Subdirs = append(info.Subdirs, e.Name())
 		} else if !e.IsDir() && !info.config.isExcludedFile(entryRel) {
diff --git a/walk/walk.go b/walk/walk.go
index 0e59bcf..ae1f513 100644
--- a/walk/walk.go
+++ b/walk/walk.go
@@ -310,6 +310,10 @@ type walker struct {
 	// If the Config.Strict flag is set in the root configuration, we return
 	// quickly after the first error.
 	errs []error
+
+	// PATCH(gitignore) ---
+	gitignoreProcessor func(string, string, interface{}) (func([]string, bool) bool, interface{})
+	// END-PATCH(gitignore) ---
 }
 
 type visitInfo struct {
@@ -373,6 +377,12 @@ func newWalker(c *config.Config, cexts []config.Configurer, dirs []string, mode
 		relsToVisitSeen: make(map[string]struct{}),
 	}
 
+	// PATCH(gitignore) ---
+	if ext, hasExt := c.Exts["__aspect:gitignoreProcessor"]; hasExt {
+		w.gitignoreProcessor = ext.(func(string, string, interface{}) (func([]string, bool) bool, interface{}))
+	}
+	// END-PATCH(gitignore) ---
+
 	// Asynchronously populate the walker cache in the background.
 	go w.populateCache()
 
